# SHIELD Framework - Extended Validation Rules
# Domain-specific validation for Brazilian public procurement (editais)
# Version: 1.1.0
# Hist√≥ria: 2.10 - Additional Validation Rules

validation_rules:
  name: "Valida√ß√£o de Conformidade Legal e Completude - Editais"
  type: "domain_specific"
  agent: "document_structurer"
  version: "1.1.0"
  total_rules: 30  # 16 existing + 14 new

  description: |
    Regras adicionais de valida√ß√£o para garantir conformidade legal com
    legisla√ß√£o brasileira de licita√ß√µes (Lei 8.666/93 e Lei 14.133/2021),
    completude de informa√ß√µes essenciais, e consist√™ncia interna do edital.

  # ==========================================================================
  # LEGAL COMPLIANCE RULES (6 rules)
  # Verificam conformidade com legisla√ß√£o de licita√ß√µes p√∫blicas no Brasil
  # ==========================================================================
  legal_compliance:
    - id: "LC-01"
      name: "Lei 8.666/93 - Cl√°usulas Obrigat√≥rias"
      description: "Verifica presen√ßa de cl√°usulas obrigat√≥rias da Lei 8.666/93"
      severity: "CRITICAL"
      category: "Legal Compliance"

      validation_logic:
        required_clauses:
          - pattern: "objeto.*licita√ß√£o|objeto.*edital"
            description: "Objeto da licita√ß√£o"
            article: "Art. 40, I"

          - pattern: "prazo.*entrega|prazo.*execu√ß√£o"
            description: "Prazo de entrega/execu√ß√£o"
            article: "Art. 40, III"

          - pattern: "san√ß√µes|penalidades|multa"
            description: "San√ß√µes administrativas"
            article: "Art. 40, XVI"

          - pattern: "dota√ß√£o.*or√ßament√°ria|previs√£o.*or√ßament√°ria"
            description: "Dota√ß√£o or√ßament√°ria"
            article: "Art. 14"

          - pattern: "crit√©rio.*julgamento|tipo.*licita√ß√£o"
            description: "Crit√©rio de julgamento"
            article: "Art. 40, VII"

      pass_criteria: "Todas as 5 cl√°usulas obrigat√≥rias presentes"
      fail_criteria: "Qualquer cl√°usula obrigat√≥ria ausente"
      remediation: "Adicionar cl√°usulas faltantes conforme Lei 8.666/93"

    - id: "LC-02"
      name: "Lei 14.133/2021 - Compatibilidade"
      description: "Verifica se edital √© compat√≠vel com nova Lei de Licita√ß√µes"
      severity: "WARNING"
      category: "Legal Compliance"

      validation_logic:
        check_references:
          - pattern: "lei.*14\\.?133|nova.*lei.*licita√ß√µes"
            indicates: "Edital referencia Lei 14.133/2021"

          - pattern: "lei.*8\\.?666"
            indicates: "Edital referencia Lei 8.666/93 (antiga)"

        compatibility_flags:
          - "Modalidade compat√≠vel com Lei 14.133/2021"
          - "Crit√©rios de julgamento atualizados"
          - "Prazos em conformidade com nova lei"

      pass_criteria: "Edital compat√≠vel com Lei 14.133/2021 ou justifica uso de Lei 8.666/93"
      fail_criteria: "Refer√™ncias desatualizadas sem justificativa"
      remediation: "Verificar se edital deve ser atualizado para Lei 14.133/2021"

    - id: "LC-03"
      name: "Prazos Legais M√≠nimos"
      description: "Verifica se prazos atendem aos m√≠nimos legais por modalidade"
      severity: "CRITICAL"
      category: "Legal Compliance"

      validation_logic:
        modalidade_prazos:
          pregao_eletronico:
            prazo_minimo_proposta: 8  # dias √∫teis
            prazo_minimo_impugnacao: 3  # dias √∫teis
            fundamento: "Lei 10.520/2002, Art. 4¬∫"

          concorrencia:
            prazo_minimo_proposta: 30  # dias corridos (obras/servi√ßos)
            prazo_minimo_impugnacao: 5  # dias √∫teis
            fundamento: "Lei 8.666/93, Art. 21"

          tomada_precos:
            prazo_minimo_proposta: 15  # dias corridos
            prazo_minimo_impugnacao: 5  # dias √∫teis
            fundamento: "Lei 8.666/93, Art. 21"

        extract_patterns:
          - pattern: "prazo.*(?:proposta|envio).*?(\\d+).*dias?"
            extracts: "prazo_proposta"

          - pattern: "impugna√ß√£o.*?(\\d+).*dias?"
            extracts: "prazo_impugnacao"

      pass_criteria: "Todos os prazos atendem aos m√≠nimos legais"
      fail_criteria: "Qualquer prazo inferior ao m√≠nimo legal"
      remediation: "Ajustar prazos para atender requisitos legais m√≠nimos"

    - id: "LC-04"
      name: "Garantia - Requisitos"
      description: "Verifica se requisitos de garantia (cau√ß√£o) est√£o presentes"
      severity: "WARNING"
      category: "Legal Compliance"

      validation_logic:
        garantia_patterns:
          - pattern: "garantia.*execu√ß√£o|cau√ß√£o"
            description: "Men√ß√£o a garantia de execu√ß√£o"

          - pattern: "\\d+%.*valor.*contrato|valor.*contrato.*\\d+%"
            description: "Percentual da garantia"
            expected: "At√© 10% do valor (Lei 8.666/93)"

          - pattern: "modalidade.*garantia|forma.*garantia"
            description: "Modalidades aceitas de garantia"
            expected: "Cau√ß√£o, seguro-garantia, fian√ßa banc√°ria"

      pass_criteria: "Requisitos de garantia claramente definidos quando aplic√°vel"
      fail_criteria: "Garantia exigida sem crit√©rios claros ou percentual ilegal"
      remediation: "Definir modalidades e percentuais conforme Art. 56 da Lei 8.666/93"

    - id: "LC-05"
      name: "Habilita√ß√£o Jur√≠dica"
      description: "Verifica se exig√™ncias de habilita√ß√£o jur√≠dica est√£o presentes"
      severity: "CRITICAL"
      category: "Legal Compliance"

      validation_logic:
        documentos_obrigatorios:
          - pattern: "registro.*comercial|junta.*comercial"
            description: "Registro comercial"
            fundamento: "Art. 28, I"

          - pattern: "ato.*constitutivo|contrato.*social|estatuto"
            description: "Ato constitutivo"
            fundamento: "Art. 28, II"

          - pattern: "inscri√ß√£o.*cnpj|cadastro.*nacional"
            description: "Inscri√ß√£o no CNPJ"
            fundamento: "Art. 28, IV"

          - pattern: "regularidade.*fgts|certificado.*fgts"
            description: "Regularidade com FGTS"
            fundamento: "Art. 29, IV"

      pass_criteria: "Todos os documentos de habilita√ß√£o jur√≠dica listados"
      fail_criteria: "Qualquer documento obrigat√≥rio ausente"
      remediation: "Incluir todos os documentos exigidos por Lei (Art. 28-29)"

    - id: "LC-06"
      name: "Qualifica√ß√£o T√©cnica"
      description: "Verifica se exig√™ncias de qualifica√ß√£o t√©cnica est√£o presentes"
      severity: "WARNING"
      category: "Legal Compliance"

      validation_logic:
        qualificacao_patterns:
          - pattern: "atestado.*capacidade.*t√©cnica|comprova√ß√£o.*t√©cnica"
            description: "Atestado de capacidade t√©cnica"
            fundamento: "Art. 30, ¬ß1¬∫"

          - pattern: "respons√°vel.*t√©cnico|profissional.*habilitado"
            description: "Respons√°vel t√©cnico habilitado"
            fundamento: "Art. 30, ¬ß1¬∫"

          - pattern: "certid√£o.*acervo.*t√©cnico|registro.*crea|registro.*cau"
            description: "Certid√£o de acervo t√©cnico (CAT)"
            fundamento: "Art. 30, II"

      pass_criteria: "Requisitos de qualifica√ß√£o t√©cnica presentes quando aplic√°vel"
      fail_criteria: "Exig√™ncias desproporcionais ao objeto (Art. 30, ¬ß5¬∫)"
      remediation: "Adequar exig√™ncias t√©cnicas ao objeto da licita√ß√£o"

  # ==========================================================================
  # COMPLETENESS RULES (4 rules)
  # Verificam se informa√ß√µes essenciais est√£o presentes e completas
  # ==========================================================================
  completeness:
    - id: "CP-01"
      name: "Anexos Obrigat√≥rios Referenciados"
      description: "Verifica se todos os anexos obrigat√≥rios est√£o referenciados"
      severity: "WARNING"
      category: "Completeness"

      validation_logic:
        anexos_obrigatorios:
          - "Termo de Refer√™ncia / Projeto B√°sico"
          - "Minuta do Contrato"
          - "Modelo de Proposta Comercial"
          - "Modelo de Declara√ß√µes"

        extract_pattern: "anexo.*[IiVvXx]+|anexo.*\\d+"

        cross_reference_check:
          - "Cada anexo mencionado no edital deve existir"
          - "Cada anexo deve ser claramente identificado"

      pass_criteria: "Todos os anexos obrigat√≥rios referenciados e identific√°veis"
      fail_criteria: "Anexo obrigat√≥rio n√£o mencionado ou refer√™ncia amb√≠gua"
      remediation: "Listar todos os anexos obrigat√≥rios com identifica√ß√£o clara"

    - id: "CP-02"
      name: "Informa√ß√µes de Contato Completas"
      description: "Verifica presen√ßa de informa√ß√µes de contato do √≥rg√£o"
      severity: "WARNING"
      category: "Completeness"

      validation_logic:
        required_contact_info:
          - pattern: "\\(\\d{2}\\).*\\d{4,5}-?\\d{4}|telefone.*\\d+"
            description: "Telefone"

          - pattern: "[\\w\\.]+@[\\w\\.]+\\.[a-zA-Z]{2,}"
            description: "E-mail"

          - pattern: "endere√ßo|rua|avenida.*\\d+|cep.*\\d{5}-?\\d{3}"
            description: "Endere√ßo f√≠sico"

          - pattern: "hor√°rio.*atendimento|expediente"
            description: "Hor√°rio de atendimento"

      pass_criteria: "Pelo menos telefone e e-mail presentes"
      fail_criteria: "Informa√ß√µes de contato insuficientes"
      remediation: "Incluir telefone, e-mail e endere√ßo do √≥rg√£o licitante"

    - id: "CP-03"
      name: "Cronograma/Calend√°rio Completo"
      description: "Verifica se cronograma com datas importantes est√° presente"
      severity: "CRITICAL"
      category: "Completeness"

      validation_logic:
        required_dates:
          - pattern: "publica√ß√£o.*edital|data.*publica√ß√£o"
            description: "Data de publica√ß√£o"

          - pattern: "prazo.*esclarecimento|esclarecimento.*at√©"
            description: "Prazo para esclarecimentos"

          - pattern: "data.*sess√£o|abertura.*proposta|data.*preg√£o"
            description: "Data da sess√£o/abertura"

          - pattern: "in√≠cio.*vig√™ncia|assinatura.*contrato"
            description: "In√≠cio da vig√™ncia/assinatura"

      pass_criteria: "Todas as datas cr√≠ticas presentes e em ordem cronol√≥gica"
      fail_criteria: "Qualquer data cr√≠tica ausente"
      remediation: "Incluir cronograma completo com todas as datas relevantes"

    - id: "CP-04"
      name: "Condi√ß√µes de Pagamento Definidas"
      description: "Verifica se condi√ß√µes e prazos de pagamento est√£o claros"
      severity: "CRITICAL"
      category: "Completeness"

      validation_logic:
        payment_info:
          - pattern: "prazo.*pagamento|pagamento.*\\d+.*dias"
            description: "Prazo de pagamento"

          - pattern: "forma.*pagamento|condi√ß√µes.*pagamento"
            description: "Forma de pagamento"

          - pattern: "medi√ß√£o|faturamento|nota.*fiscal"
            description: "Processo de medi√ß√£o/faturamento"

          - pattern: "reajuste|corre√ß√£o.*monet√°ria|√≠ndice"
            description: "Crit√©rios de reajuste"

      pass_criteria: "Prazo e forma de pagamento claramente definidos"
      fail_criteria: "Informa√ß√µes de pagamento amb√≠guas ou ausentes"
      remediation: "Definir prazo, forma e processo de pagamento detalhadamente"

  # ==========================================================================
  # CONSISTENCY RULES (4 rules)
  # Verificam consist√™ncia interna entre diferentes partes do edital
  # ==========================================================================
  consistency:
    - id: "CS-01"
      name: "Ordem Cronol√≥gica de Datas"
      description: "Verifica se todas as datas est√£o em ordem cronol√≥gica l√≥gica"
      severity: "WARNING"
      category: "Consistency"

      validation_logic:
        date_sequence_check:
          expected_order:
            - "data_publicacao"
            - "prazo_esclarecimentos"
            - "prazo_impugnacao"
            - "data_sessao_abertura"
            - "prazo_entrega"
            - "inicio_vigencia"

        validation_rules:
          - "Data de publica√ß√£o < Data de abertura"
          - "Prazo de impugna√ß√£o < Data de abertura"
          - "Data de abertura < Prazo de entrega"
          - "Prazo de entrega <= In√≠cio de vig√™ncia"

      pass_criteria: "Todas as datas em ordem cronol√≥gica l√≥gica"
      fail_criteria: "Qualquer data fora de sequ√™ncia l√≥gica"
      remediation: "Corrigir sequ√™ncia de datas para ordem cronol√≥gica correta"

    - id: "CS-02"
      name: "Soma de Valores (Itens vs. Total)"
      description: "Verifica se soma dos itens corresponde ao valor total estimado"
      severity: "CRITICAL"
      category: "Consistency"

      validation_logic:
        value_check:
          extract_total: "valor.*total.*estimado|valor.*global"
          extract_items: "item.*\\d+.*R?\\$.*[\\d\\.,]+"

          tolerance: 0.01  # 1% de toler√¢ncia para arredondamentos

          validation:
            - "Somar valores de todos os itens"
            - "Comparar com valor total declarado"
            - "Diferen√ßa deve ser <= toler√¢ncia"

      pass_criteria: "Soma dos itens = valor total (¬± 1%)"
      fail_criteria: "Diferen√ßa > 1% entre soma e total"
      remediation: "Corrigir valores dos itens ou valor total para consist√™ncia"

    - id: "CS-03"
      name: "Unidades de Medida Consistentes"
      description: "Verifica se unidades de medida s√£o usadas consistentemente"
      severity: "WARNING"
      category: "Consistency"

      validation_logic:
        unit_standardization:
          common_units:
            - ["unidade", "un", "und", "pe√ßa"]
            - ["metro", "m", "metros"]
            - ["quilograma", "kg", "kilo"]
            - ["litro", "l", "lt"]
            - ["hora", "h", "hrs"]

          consistency_check:
            - "Mesmo item deve usar mesma unidade em todo edital"
            - "Convers√µes devem estar expl√≠citas"
            - "Unidades devem seguir padr√£o brasileiro (INMETRO)"

      pass_criteria: "Unidades consistentes e padronizadas"
      fail_criteria: "Mesma grandeza com unidades diferentes sem convers√£o"
      remediation: "Padronizar unidades conforme INMETRO ou incluir convers√µes"

    - id: "CS-04"
      name: "Refer√™ncias Cruzadas V√°lidas"
      description: "Verifica se todas as refer√™ncias a se√ß√µes/itens existem"
      severity: "WARNING"
      category: "Consistency"

      validation_logic:
        reference_validation:
          extract_references:
            - pattern: "(?:conforme|vide|ver).*(?:item|se√ß√£o|anexo|cap√≠tulo).*([\\d\\.]+)"
              extracts: "referenced_section"

            - pattern: "anexo.*([IiVvXx]+|\\d+)"
              extracts: "referenced_annex"

          extract_existing_sections:
            - pattern: "^\\d+\\.?\\d*\\.?\\d*\\s"
              extracts: "existing_section"

          validation:
            - "Cada refer√™ncia deve apontar para se√ß√£o/anexo existente"
            - "Links internos devem ser v√°lidos"

      pass_criteria: "100% das refer√™ncias apontam para se√ß√µes/anexos existentes"
      fail_criteria: "Qualquer refer√™ncia quebrada ou inv√°lida"
      remediation: "Corrigir refer√™ncias quebradas ou adicionar se√ß√µes faltantes"

# ==========================================================================
# SEVERITY LEVELS
# ==========================================================================
severity_levels:
  CRITICAL:
    description: "Viola√ß√£o bloqueia entrega - requer corre√ß√£o imediata"
    action: "LOOP (retornar para corre√ß√£o)"
    color: "red"
    symbol: "üî¥"

  WARNING:
    description: "Problema s√©rio que deve ser revisado antes de prosseguir"
    action: "Sinalizar para revis√£o humana"
    color: "yellow"
    symbol: "üü°"

  INFO:
    description: "Sugest√£o de melhoria - n√£o bloqueia entrega"
    action: "Registrar no relat√≥rio"
    color: "blue"
    symbol: "üîµ"

# ==========================================================================
# SCORING AND USAGE
# ==========================================================================
scoring:
  method: "weighted"
  weights:
    CRITICAL: 10
    WARNING: 5
    INFO: 1

  pass_threshold:
    CRITICAL: "100%"  # Todos os CRITICAL devem passar
    WARNING: "80%"    # 80% dos WARNING devem passar
    INFO: "0%"        # INFO n√£o bloqueia

  fail_action: "LOOP"
  max_loop_iterations: 3

usage:
  when_to_use: "Ap√≥s valida√ß√£o b√°sica (ED-01 a ED-08 e AA-01 a AA-08)"
  integration: "Integrado ao validation_engine.py"
  output_format: "validation_report.yaml"

# Metadata
metadata:
  created_by: "Hist√≥ria 2.10 - Sprint 4.5"
  created_at: "2025-11-06"
  version: "1.1.0"
  total_new_rules: 14
  total_rules: 30  # 8 AA + 8 ED + 6 LC + 4 CP + 4 CS
