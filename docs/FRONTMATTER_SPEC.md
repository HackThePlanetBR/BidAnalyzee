# Frontmatter Specification for Web Scrapers

**Purpose:** Define the exact YAML frontmatter format required for all scraped documentation to integrate with the RAG system.

---

## üìã Required Format

All markdown files generated by web scrapers must include YAML frontmatter at the beginning of the file:

```markdown
---
title: "Document Title Here"
url: "https://full-source-url.com/path/to/document.html"
source: "Source Website Name"
category: "Category Name"
date: "2025-11-17"
language: "en"
---

# Document Title Here

Document content starts here...
```

---

## üîë Field Specifications

### Required Fields

#### `title` (string)
- **Description:** Human-readable document title
- **Source:** Extract from `<h1>`, `<title>`, or URL
- **Format:** Plain text, no special formatting
- **Max Length:** 200 characters (recommended)
- **Example:** `"API Authentication Guide"`

**Rules:**
- Must not be empty
- Should be descriptive and unique
- Used as filename base (sanitized)
- Displayed in RAG search results

---

#### `url` (string)
- **Description:** Absolute URL of the source document
- **Source:** Full URL where content was scraped
- **Format:** Absolute URL (must include protocol)
- **Example:** `"https://help.securitycentersaas.genetec.cloud/en/api/auth.html"`

**Rules:**
- Must be absolute (not relative)
- Must be accessible (valid URL)
- Used in CSV analysis (`Fonte_URL` column)
- Should be the canonical URL (prefer without tracking parameters)

---

#### `source` (string)
- **Description:** Name of the source website/documentation portal
- **Format:** Plain text, title case
- **Example:** `"Security Center SaaS Help"`

**Values by Site:**
| Website | Source Value |
|---------|--------------|
| https://help.securitycentersaas.genetec.cloud/en/ | `"Security Center SaaS Help"` |
| https://compliance.genetec.com/ | `"Genetec Compliance Portal"` |
| https://techdocs.genetec.com/ | `"Genetec Technical Documentation"` |

**Rules:**
- Must match one of the predefined values
- Used in CSV analysis (`Fonte_Titulo` column)
- Used for filtering/grouping in RAG queries

---

#### `category` (string)
- **Description:** Content category for classification
- **Format:** Plain text, title case
- **Example:** `"SCSaaS"`, `"Security/Compliance"`, `"Security Center"`

**Values by Site:**
| Website | Category Logic | Example Values |
|---------|----------------|----------------|
| SCSaaS Help | Static: `SCSaaS` | `"SCSaaS"` |
| Compliance Portal | Static: `Security/Compliance` | `"Security/Compliance"` |
| TechDocs | Dynamic: Extract from product name | `"Security Center"`, `"Synergis"`, `"AutoVu"`, `"Genetec ClearID"` |

**Rules:**
- Must not be empty
- Critical for RAG analysis (flows to CSV `Categoria` column)
- Used for filtering and classification
- For TechDocs: Must be extracted from URL/content

**TechDocs Product Mapping:**
```python
PRODUCT_CATEGORIES = {
    'securitycenter': 'Security Center',
    'synergis': 'Synergis',
    'autovu': 'AutoVu',
    'clearid': 'Genetec ClearID',
    'streamvault': 'Genetec StreamVault',
    'sipdesk': 'Genetec SIP Desk',
    'missioncontrol': 'Genetec Mission Control',
    # Add more as discovered
}
```

---

#### `date` (string)
- **Description:** Date of content extraction
- **Format:** ISO 8601 date format (YYYY-MM-DD)
- **Example:** `"2025-11-17"`

**Rules:**
- Must be valid ISO date
- Should be extraction date (not publication date)
- Use `datetime.now().strftime('%Y-%m-%d')` in Python

---

#### `language` (string)
- **Description:** Content language code
- **Format:** ISO 639-1 two-letter code
- **Example:** `"en"`

**Rules:**
- Must always be `"en"` (English-only requirement)
- Used to validate language filtering
- Only English content should be scraped

---

### Optional Fields

#### `product` (string)
- **Description:** Specific product name
- **Format:** Plain text
- **Example:** `"Security Center"`, `"Synergis"`
- **When to Use:** TechDocs scraper (can be same as category)

---

#### `version` (string)
- **Description:** Product version or documentation version
- **Format:** Semantic version or "latest"
- **Example:** `"5.11"`, `"2.12"`, `"latest"`
- **When to Use:** TechDocs when version is in URL

---

#### `tags` (list of strings)
- **Description:** Searchable tags/keywords
- **Format:** YAML list
- **Example:**
  ```yaml
  tags:
    - api
    - authentication
    - saas
  ```
- **When to Use:** Optional enhancement for search

---

## üéØ Implementation Examples

### Example 1: SCSaaS Help Document

```markdown
---
title: "Configure API access for Security Center SaaS"
url: "https://help.securitycentersaas.genetec.cloud/en/api/configure-access.html"
source: "Security Center SaaS Help"
category: "SCSaaS"
date: "2025-11-17"
language: "en"
---

# Configure API access for Security Center SaaS

To configure API access...
```

---

### Example 2: Compliance Portal Document

```markdown
---
title: "SOC 2 Type II Certification"
url: "https://compliance.genetec.com/?itemName=certifications"
source: "Genetec Compliance Portal"
category: "Security/Compliance"
date: "2025-11-17"
language: "en"
---

# SOC 2 Type II Certification

Genetec maintains SOC 2 Type II certification...
```

---

### Example 3: TechDocs Document

```markdown
---
title: "Security Center Admin Guide - Camera Configuration"
url: "https://techdocs.genetec.com/securitycenter/5.11/admin/cameras/config.html"
source: "Genetec Technical Documentation"
category: "Security Center"
date: "2025-11-17"
language: "en"
product: "Security Center"
version: "5.11"
---

# Camera Configuration

This section describes how to configure cameras...
```

---

## ‚úÖ Validation Rules

### YAML Syntax
- Must be valid YAML
- Must start with `---` and end with `---`
- Must be at the very beginning of the file (no whitespace before)
- Fields must be properly quoted if they contain special characters

### Content Validation
```python
def validate_frontmatter(frontmatter: dict) -> bool:
    """Validate frontmatter has all required fields"""

    required_fields = ['title', 'url', 'source', 'category', 'date', 'language']

    # Check all required fields exist
    for field in required_fields:
        if field not in frontmatter or not frontmatter[field]:
            return False

    # Validate URL format
    if not frontmatter['url'].startswith('http'):
        return False

    # Validate language is English
    if frontmatter['language'] != 'en':
        return False

    # Validate date format (ISO)
    try:
        datetime.strptime(frontmatter['date'], '%Y-%m-%d')
    except ValueError:
        return False

    return True
```

---

## üîó Integration with RAG System

### How Metadata Flows Through the System

1. **Scraper** generates markdown with frontmatter
2. **Ingestion Pipeline** (`ingestion_pipeline.py`) extracts frontmatter using regex:
   ```python
   frontmatter_pattern = r'^---\s*\n(.*?)\n---\s*\n'
   ```
3. **Metadata** is parsed from YAML and stored with each chunk
4. **RAG Search** returns metadata with results
5. **Query Processor** uses metadata for analysis:
   - `category` ‚Üí CSV `Categoria` column
   - `title` ‚Üí CSV `Fonte_Titulo` column
   - `url` ‚Üí CSV `Fonte_URL` column

### Example RAG Search Result

```json
{
  "text": "API authentication requires OAuth 2.0...",
  "similarity_score": 0.92,
  "metadata": {
    "title": "API Authentication Guide",
    "url": "https://help.scsaas.genetec.cloud/en/api/auth.html",
    "source": "Security Center SaaS Help",
    "category": "SCSaaS",
    "language": "en",
    "filename": "api-authentication-guide-a3f2d1.md"
  }
}
```

### Example CSV Output Row

```csv
ID,Requisito,Categoria,Veredicto,Confian√ßa,Evid√™ncias,Racioc√≠nio,Recomenda√ß√µes,Fonte_Titulo,Fonte_URL
1,"API OAuth 2.0",SCSaaS,CONFORME,0.95,"api-auth.md:45","...","...","API Authentication Guide","https://help.scsaas.genetec.cloud/en/api/auth.html"
```

---

## üõ†Ô∏è Python Implementation

### Frontmatter Generator Function

```python
from datetime import datetime
import yaml

def generate_frontmatter(
    title: str,
    url: str,
    source: str,
    category: str,
    language: str = "en",
    product: str = None,
    version: str = None,
    tags: list = None
) -> str:
    """
    Generate YAML frontmatter for markdown files.

    Args:
        title: Document title
        url: Source URL (absolute)
        source: Source website name
        category: Content category
        language: Language code (default: "en")
        product: Product name (optional)
        version: Product version (optional)
        tags: List of tags (optional)

    Returns:
        Formatted YAML frontmatter string

    Raises:
        ValueError: If required fields are missing
    """
    # Validate required fields
    if not all([title, url, source, category]):
        raise ValueError("Missing required fields")

    if not url.startswith('http'):
        raise ValueError("URL must be absolute")

    if language != 'en':
        raise ValueError("Only English content allowed")

    # Build metadata dict
    metadata = {
        'title': title,
        'url': url,
        'source': source,
        'category': category,
        'date': datetime.now().strftime('%Y-%m-%d'),
        'language': language
    }

    # Add optional fields
    if product:
        metadata['product'] = product
    if version:
        metadata['version'] = version
    if tags:
        metadata['tags'] = tags

    # Generate YAML
    yaml_content = yaml.dump(
        metadata,
        default_flow_style=False,
        allow_unicode=True,
        sort_keys=False
    )

    return f"---\n{yaml_content}---\n"
```

### Usage Example

```python
# Generate frontmatter
frontmatter = generate_frontmatter(
    title="API Authentication Guide",
    url="https://help.securitycentersaas.genetec.cloud/en/api/auth.html",
    source="Security Center SaaS Help",
    category="SCSaaS"
)

# Combine with content
markdown_content = "# API Authentication\n\nThis guide explains..."
full_document = frontmatter + "\n" + markdown_content

# Save to file
with open('api-auth-guide.md', 'w', encoding='utf-8') as f:
    f.write(full_document)
```

---

## üîç Testing Frontmatter

### Manual Validation

```bash
# Extract and validate YAML from markdown file
python -c "
import yaml
import re

with open('document.md', 'r') as f:
    content = f.read()

match = re.match(r'^---\s*\n(.*?)\n---', content, re.DOTALL)
if match:
    metadata = yaml.safe_load(match.group(1))
    print('Valid YAML:', metadata)

    # Check required fields
    required = ['title', 'url', 'source', 'category', 'date', 'language']
    missing = [f for f in required if f not in metadata]

    if missing:
        print('Missing fields:', missing)
    else:
        print('All required fields present!')
else:
    print('No frontmatter found!')
"
```

### Automated Validation Script

```python
import os
import re
import yaml
from pathlib import Path

def validate_knowledge_base(kb_path: str):
    """Validate all markdown files in knowledge base"""

    issues = []
    valid_count = 0

    for md_file in Path(kb_path).rglob('*.md'):
        with open(md_file, 'r', encoding='utf-8') as f:
            content = f.read()

        # Extract frontmatter
        match = re.match(r'^---\s*\n(.*?)\n---', content, re.DOTALL)

        if not match:
            issues.append(f"{md_file}: No frontmatter found")
            continue

        try:
            metadata = yaml.safe_load(match.group(1))
        except yaml.YAMLError as e:
            issues.append(f"{md_file}: Invalid YAML - {e}")
            continue

        # Check required fields
        required = ['title', 'url', 'source', 'category', 'date', 'language']
        missing = [f for f in required if f not in metadata]

        if missing:
            issues.append(f"{md_file}: Missing fields - {missing}")
            continue

        # Validate language
        if metadata['language'] != 'en':
            issues.append(f"{md_file}: Non-English content - {metadata['language']}")
            continue

        valid_count += 1

    return valid_count, issues

# Run validation
valid, issues = validate_knowledge_base('data/knowledge_base/genetec')
print(f"Valid: {valid}, Issues: {len(issues)}")
for issue in issues:
    print(f"  - {issue}")
```

---

## üìö References

- **RAG Ingestion:** `agents/technical_analyst/ingestion_pipeline.py:39-53`
- **Example Document:** `data/knowledge_base/mock/exemplo_com_url.md`
- **Query Processor:** `agents/technical_analyst/query_processor.py:153-168`
- **YAML Spec:** https://yaml.org/spec/1.2/spec.html

---

**End of Frontmatter Specification**
**Version:** 1.0
**Last Updated:** 2025-11-17
